build_image: chetantarale/u14php7pls:tip

language: 
  - php

php: 
  - '7.0'
  
services:
  - redis

before_script: 
  - currentLocation="$PWD"
  - sudo apt-get install php7.0-dev
  - wget http://xdebug.org/files/xdebug-2.4.0rc2.tgz
  - tar -xzf xdebug-2.4.0rc2.tgz
  - cd xdebug-2.4.0RC2/
  - phpize
  - ./configure --enable-xdebug
  - make
  - sudo cp modules/xdebug.so /usr/lib/.
  #FOR FPM
  - sudo echo 'zend_extension="/usr/lib/xdebug.so"' > /etc/php/7.0/fpm/conf.d/20-xdebug.ini 
  - sudo echo 'xdebug.remote_enable=1' >> /etc/php/7.0/fpm/conf.d/20-xdebug.ini 
  #FOR CLI
  - sudo echo 'zend_extension="/usr/lib/xdebug.so"' > /etc/php/7.0/cli/conf.d/20-xdebug.ini 
  - sudo echo 'xdebug.remote_enable=1' >> /etc/php/7.0/cli/conf.d/20-xdebug.ini
  #RESTART
  - sudo service php7.0-fpm restart
  - git clone https://github.com/phpredis/phpredis.git
  - cd phpredis
  - git checkout php7
  - phpize
  - ./configure
  - make && make install
  - cd ..
  - rm -rf phpredis
  - sudo service php7.0-fpm restart
  - sudo service redis-server restart
  - ls /etc/php/7.0/mods-available
  - echo "extension=redis.so" > /etc/php/7.0/mods-available/redis.ini
  - ln -sf /etc/php/7.0/mods-available/redis.ini /etc/php/7.0/fpm/conf.d/20-redis.ini
  - ln -sf /etc/php/7.0/mods-available/redis.ini /etc/php/7.0/cli/conf.d/20-redis.ini
  - service php7.0-fpm restart
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - wget https://phar.phpunit.de/phpunit.phar
  - chmod +x phpunit.phar
  - sudo mv phpunit.phar /usr/local/bin/phpunit
  - phpunit --version
  - cd "$currentLocation"


script:
  - phpunit  --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage tests/RedisExampleTest.php
